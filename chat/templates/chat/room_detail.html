{% extends 'users/base.html' %}
{% load static %}
{% block title %}Чат: {{ room.name }}{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-2">
  <h2 class="h4 mb-0">{{ room.name }}</h2>
  <form action="{% url 'chat:leave' room.slug %}" method="post" class="d-inline">
    {% csrf_token %}
    <button class="btn btn-outline-secondary btn-sm">
      <i class="bi bi-box-arrow-left"></i> Вийти
    </button>
  </form>
</div>

{# ── показуємо попередження для гостей ────────────────────────── #}
{% if not user.is_authenticated %}
<div class="alert alert-info">
  Ви переглядаєте чат як&nbsp;гість.
  <a href="{% url 'users:login' %}?next={{ request.path }}">Увійти</a>,
  щоб лишати повідомлення.
</div>
{% endif %}

<div id="chat-box" class="border rounded p-2 mb-2"
     style="height:400px; overflow-y:auto;"
     data-slug="{{ room.slug }}">
  {% for msg in room.messages.all %}
    <div>
      <strong>{{ msg.author.username }}</strong>
      [{{ msg.created|time:"H:i" }}]: {{ msg.content }}
      {% if msg.file %}
        <a href="{{ msg.file.url }}" download>📎</a>
      {% endif %}
    </div>
  {% endfor %}
</div>

{% if user.is_authenticated %}
<form id="msg-form" class="input-group" method="post" enctype="multipart/form-data">
  {% csrf_token %}
  <input id="msg-input" name="content" class="form-control" placeholder="Повідомлення…">
  <input id="file-input" type="file" name="file" class="form-control">
  <button id="send-btn" type="button" class="btn btn-primary">
    <i class="bi bi-send"></i>
  </button>
</form>
{% endif %}

<script src="{% static 'chat/js/chat.js' %}"></script>
{% endblock %}

