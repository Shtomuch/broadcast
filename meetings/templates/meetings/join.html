{% extends 'users/base.html' %}
{% load static %}

{% block title %}Приєднатися до {{ meeting.title }}{% endblock %}

{% block extra_css %}
<style>
  html, body {
    height: 100% !important;
    margin: 0 !important;
    padding: 0 !important;
  }
  body.d-flex.flex-column.min-vh-100 {
    display: block !important;
  }
  #jitsi-container,
  #jitsi-container > *,
  .prejoin-screen,
  .welcome-page-content,
  .lobby-page-container {
    height: 100% !important;
    width: 100% !important;
    margin: 0;
    padding: 0;
  }
</style>
{% endblock %}

{% block extra_js %}
  <script>const JITSI_DOMAIN = '{{ JITSI_DOMAIN }}';</script>
  <script src="https://{{ JITSI_DOMAIN }}/external_api.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      document.body.classList.remove('d-flex', 'flex-column', 'min-vh-100');
      document.body.innerHTML = '<div id="jitsi-container"></div>';
      const options = {
        roomName: '{{ meeting.jitsi_room }}',
        parentNode: document.getElementById('jitsi-container'),
        width: '100%',
        height: '100%',
        configOverwrite: { prejoinPageEnabled: true, enableWelcomePage: false, lobbyEnabled: false },
        interfaceConfigOverwrite: { TOOLBAR_BUTTONS: ['microphone','camera','desktop','hangup','chat','tileview','recording'] }
      };
      const api = new JitsiMeetExternalAPI(JITSI_DOMAIN, options);
      const goHome = () => window.location.href = '{% url "home" %}';
      api.addEventListener('videoConferenceLeft', goHome);
      api.addEventListener('readyToClose', goHome);
    });
  </script>
{% endblock %}

{% block content %}{% endblock %}
